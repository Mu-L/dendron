/* eslint-disable import/no-dynamic-require, global-require */
import fs from "fs-extra";
import path from "path";

type Sidebars = {};
type SidebarsConfig = {};

export const DefaultSidebars: SidebarsConfig = {
  defaultSidebar: [
    {
      type: "autogenerated",
      id: ".",
    },
  ],
};

export const DisabledSidebars: SidebarsConfig = {};

async function loadSidebarsFile(
  sidebarFilePath: string | false | undefined
): Promise<SidebarsConfig> {
  // false => no sidebars
  if (sidebarFilePath === false) {
    return DisabledSidebars;
  }

  // undefined => defaults to autogenerated sidebars
  if (typeof sidebarFilePath === "undefined") {
    return DefaultSidebars;
  }

  // Non-existent sidebars file: no sidebars
  if (!(await fs.pathExists(sidebarFilePath))) {
    return DisabledSidebars;
  }

  return require(path.resolve(sidebarFilePath));
}

export async function loadSidebars(
  sidebarFilePath: string | false | undefined
): Promise<Sidebars> {
  try {
    return await loadSidebarsFile(sidebarFilePath);
  } catch (err) {
    console.error`Sidebars file at path=${
      sidebarFilePath as string
    } failed to be loaded.`;
    throw err;
  }
}
